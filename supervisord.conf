[supervisord]
nodaemon=true
logfile=/var/log/supervisord.log
loglevel=info
pidfile=/var/run/supervisord.pid

# ---------- Kafka ----------
[program:kafka]
command=/opt/kafka/bin/kafka-server-start.sh /opt/kafka/config/server.properties
autostart=true
autorestart=true
startretries=20
startsecs=10
stdout_logfile=/var/log/kafka.out.log
stderr_logfile=/var/log/kafka.err.log

# ---------- ClickHouse ----------
[program:clickhouse]
command=/usr/bin/clickhouse-server --config-file=/etc/clickhouse-server/config.xml
autostart=true
autorestart=true
startretries=5
startsecs=10
stdout_logfile=/var/log/clickhouse.out.log
stderr_logfile=/var/log/clickhouse.err.log

# ---------- Grafana ----------
[program:grafana]
command=/usr/sbin/grafana-server --homepath=/usr/share/grafana
autostart=true
autorestart=true
startretries=3
startsecs=5
stdout_logfile=/var/log/grafana.out.log
stderr_logfile=/var/log/grafana.err.log

# ---------- Prometheus ----------
[program:prometheus]
command=/opt/prometheus/prometheus --config.file=/etc/prometheus/prometheus.yml --storage.tsdb.path=/prometheus
autostart=true
autorestart=true
startretries=3
startsecs=5
stdout_logfile=/var/log/prometheus.out.log
stderr_logfile=/var/log/prometheus.err.log

# ---------- Blackbox ----------
[program:blackbox]
command=/opt/blackbox_exporter/blackbox_exporter --config.file=/etc/blackbox/blackbox.yml
autostart=true
autorestart=true
startretries=3
startsecs=5
stdout_logfile=/var/log/blackbox.out.log
stderr_logfile=/var/log/blackbox.err.log

# ---------- Loki ----------
[program:loki]
command=/usr/local/bin/loki -config.file=/etc/loki/local-config.yaml
autostart=true
autorestart=true
startretries=3
startsecs=5
stdout_logfile=/var/log/loki.out.log
stderr_logfile=/var/log/loki.err.log

# ---------- Promtail ----------
[program:promtail]
command=/usr/local/bin/promtail -config.file=/etc/promtail/config.yml
autostart=true
autorestart=true
startretries=5
startsecs=10
stdout_logfile=/var/log/promtail.out.log
stderr_logfile=/var/log/promtail.err.log
priority=10

# ---------- Pipeline ----------
[program:pipeline]
command=python /app/main.py
directory=/app
autostart=true
autorestart=true
startretries=5
startsecs=10
stdout_logfile=/var/log/pipeline.out.log
stderr_logfile=/var/log/pipeline.err.log
priority=20
